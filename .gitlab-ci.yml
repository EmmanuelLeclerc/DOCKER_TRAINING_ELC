variables:
  JFROG_REPO: adeo-docker-adeo-davidson-dev.jfrog.io
  DOCKER_IMAGE_TUTOBDD: tutobdd-elc
  DOCKER_IMAGE_TUTOAPI: tutoapi-elc

services:
  - docker:dind

stages:
  - build
  - test
  - push_tuto
  - deploy

build:
  stage: build
  image: node:alpine
  tags:
    - docker
  script: 
    - node --check tutoapi/app.js

#test:
#  stage: test
#  script:
#    - echo "${JFROG_USER}"
#    - echo "${JFROG_REPO}"

push_tutobdd:
  stage: push_tuto
  image: docker
  tags:
    - docker
  script:
    - docker login -u ${JFROG_USER} -p ${JFROG_TOKEN} ${JFROG_REPO}
    - cd bdd && docker build -t ${DOCKER_IMAGE_TUTOBDD} .
    - docker tag tutobdd-elc ${JFROG_REPO}/${DOCKER_IMAGE_TUTOBDD}
    - docker push ${JFROG_REPO}/${DOCKER_IMAGE_TUTOBDD}

push_tutoapi:
  stage: push_tuto
  image: docker
  tags:
    - docker
  script:
    - docker login -u ${JFROG_USER} -p ${JFROG_TOKEN} ${JFROG_REPO}
    - cd bdd && docker build -t ${DOCKER_IMAGE_TUTOAPI} .
    - docker tag tutobdd-elc ${JFROG_REPO}/${DOCKER_IMAGE_TUTOAPI}
    - docker push ${JFROG_REPO}/${DOCKER_IMAGE_TUTOAPI}

deploy:
  stage: deploy
  script:
    - echo "test deploy" 

